import{_ as h,u as f,f as g,h as _,i as b,j as y,m as k,o as i,c as r,a as t,t as d,b as M,k as u,F as c,r as p,w as S,l as D,p as w,n as C}from"./index-a091949d.js";const I={data(){return{popupMessage:"Merci pour votre envoie!ðŸ˜Š",baseUrlImg:"https://image.tmdb.org/t/p/original/",movie:Object,tokensStore:f(),criticMessage:"",noteMessage:"",previousComment:null}},props:{id:{type:Number}},mounted(){if(g(this.id).then(e=>this.movie=e),this.isLoggedIn()){let e=this.tokensStore.getLatestTokenDetails().userId;_(e,this.id).then(s=>{if(s.statusCode==200&&s.comment!=null){this.previousComment=s.comment;let n=5-Math.floor(this.previousComment.score/2),m=document.querySelector(".rate").querySelectorAll("input");n<5&&(m[n].checked=!0),document.querySelector("#comment").innerHTML=this.previousComment.commentaire}})}},methods:{isAdmin(){return this.isLoggedIn()?this.tokensStore.getLatestTokenDetails().roleId==1:!1},isLoggedIn(){return this.tokensStore.isLoggedIn()},getYearFromDate(e){return e!=null&&(e=e.split("-",1).pop()),e},async onDeleteMovie(){b(this.tokensStore.latestToken,this.id),setTimeout(()=>{this.$router.go(-1)},4e3)},submitForm(e){const s=new FormData(e.target);this.popupMessage=[];let n=s.get("rate"),m=s.get("comment");n==null&&(n=.5),this.previousComment==null?(y(this.tokensStore.latestToken,this.id,m,n),this.popupMessage.push("Votre commentaire a Ã©tÃ© envoyÃ©!")):(k(this.tokensStore.latestToken,this.id,this.previousComment.critic_id,m,n),this.popupMessage.push("Votre commentaire a Ã©tÃ© modifiÃ©!")),document.getElementById("myModal").style.display="block"},getNumberOfStarsFromRating(e){return Math.round(e/2)},dateConvert(e){return new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})},isDifferentUser(e){return this.tokensStore.isLoggedIn()?this.tokensStore.getLatestTokenDetails().userId!=e:!0},getMovieCritics(){let e=this.movie.critiques;return this.movie.critiques?e=this.movie.critiques:e=[],e.sort((s,n)=>new Date(n.date)-new Date(s.date)),e},closePopUp(){document.getElementById("myModal").style.display="none"}}},v=e=>(w("data-v-3fb4f92e"),e=e(),C(),e),x={class:"img-main-info"},L=["src"],F={class:"main-info"},T={class:"overview"},N=["href"],V={class:"average-rating"},q={key:0,class:"static-rate full-star"},z={key:1,class:"static-rate empty-star"},B={key:0},U=v(()=>t("h3",null,"Rating",-1)),A=D('<div class="rate" data-v-3fb4f92e><input type="radio" id="star5" name="rate" value="10" data-v-3fb4f92e><label for="star5" title="text" data-v-3fb4f92e>5 stars</label><input type="radio" id="star4" name="rate" value="8" data-v-3fb4f92e><label for="star4" title="text" data-v-3fb4f92e>4 stars</label><input type="radio" id="star3" name="rate" value="6" data-v-3fb4f92e><label for="star3" title="text" data-v-3fb4f92e>3 stars</label><input type="radio" id="star2" name="rate" value="4" data-v-3fb4f92e><label for="star2" title="text" data-v-3fb4f92e>2 stars</label><input type="radio" id="star1" name="rate" value="2" data-v-3fb4f92e><label for="star1" title="text" data-v-3fb4f92e>1 star</label></div><div data-v-3fb4f92e><label for="comment" data-v-3fb4f92e>Message : </label><textarea type="text" name="comment" id="comment" placeholder="Commentaire ici..." maxlength="255" data-v-3fb4f92e></textarea></div>',2),R={key:0,id:"add-rating",type:"submit"},j={key:1,id:"update-rating",type:"submit"},O=v(()=>t("h3",null,"Critiques",-1)),P={class:"card_container"},E={class:"card_commentary"},Y={key:0},H=v(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[t("path",{d:"M12 1c-6.38 0-12 4.226-12 10.007 0 2.05.738 4.063 2.047 5.625.055 1.83-1.023 4.456-1.993 6.368 2.602-.47 6.301-1.508 7.978-2.536 9.236 2.247 15.968-3.405 15.968-9.457 0-5.812-5.701-10.007-12-10.007zm0 14h-6v-1h6v1zm6-3h-12v-1h12v1zm0-3h-12v-1h12v1z"})],-1)),G={class:"name"},J={class:"commentary"},K={class:"popup"},Q={id:"myModal",class:"modal"},W={class:"modal-content"},X=v(()=>t("path",{d:"m21 3.998c0-.478-.379-1-1-1h-16c-.62 0-1 .519-1 1v16c0 .621.52 1 1 1h16c.478 0 1-.379 1-1zm-8.991 6.932 2.717-2.718c.146-.146.338-.219.53-.219.405 0 .751.325.751.75 0 .193-.073.384-.219.531l-2.718 2.717 2.728 2.728c.147.147.22.339.22.531 0 .427-.349.75-.75.75-.192 0-.384-.073-.531-.219l-2.728-2.728-2.728 2.728c-.146.146-.339.219-.531.219-.401 0-.75-.323-.75-.75 0-.192.073-.384.22-.531l2.728-2.728-2.722-2.722c-.146-.147-.219-.338-.219-.531 0-.425.346-.749.75-.749.192 0 .384.073.53.219z","fill-rule":"nonzero"},null,-1)),Z=[X],$={id:"messages"};function ee(e,s,n,m,l,a){return i(),r(c,null,[t("h2",null,d(l.movie.titre),1),t("div",x,[t("img",{src:l.movie.imageUrl,width:"600"},null,8,L),t("div",F,[t("p",T,d(l.movie.description),1),t("p",null,"DurÃ©e: "+d(l.movie.longueur)+" min",1),t("p",null,"AnnÃ©e de parution: "+d(a.getYearFromDate(l.movie.annee)),1),t("p",null,[M("Site: "),t("a",{href:l.movie.homepage,target:"_blank"},d(l.movie.homepage),9,N)]),a.isAdmin()?(i(),r("button",{key:0,onClick:s[0]||(s[0]=o=>(e.openPopUp("Le film Ã  bel et bien Ã©tÃ© supprimÃ©"),a.onDeleteMovie()))},"Delete")):u("",!0)])]),t("div",V,[(i(),r(c,null,p(5,o=>t("div",{class:"average-rating-star",key:o},[a.getNumberOfStarsFromRating(l.movie.vote_average)>=o?(i(),r("p",q,"â˜…")):u("",!0),a.getNumberOfStarsFromRating(l.movie.vote_average)<=o-1?(i(),r("p",z,"â˜…")):u("",!0)])),64))]),a.isLoggedIn()?(i(),r("div",B,[U,t("form",{class:"rating-form",action:"",method:"post",onSubmit:s[1]||(s[1]=S((...o)=>a.submitForm&&a.submitForm(...o),["prevent"]))},[A,l.previousComment==null?(i(),r("button",R,"Ajouter")):(i(),r("button",j,"Modifier"))],32)])):u("",!0),O,t("div",P,[(i(!0),r(c,null,p(a.getMovieCritics(),o=>(i(),r("div",E,[a.isDifferentUser(o.user_id)?(i(),r("div",Y,[H,t("p",G,d(o.user_name),1),t("p",null,d(a.dateConvert(o.date)),1),t("p",J,d(o.commentaire),1)])):u("",!0)]))),256))]),t("div",K,[t("div",Q,[t("div",W,[(i(),r("svg",{id:"close",onClick:s[2]||(s[2]=o=>a.closePopUp()),"stroke-linejoin":"round","stroke-miterlimit":"2",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Z)),(i(!0),r(c,null,p(l.popupMessage,o=>(i(),r("p",$,d(o),1))),256))])])])],64)}const se=h(I,[["render",ee],["__scopeId","data-v-3fb4f92e"]]);export{se as default};
